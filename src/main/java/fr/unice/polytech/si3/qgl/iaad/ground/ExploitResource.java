package fr.unice.polytech.si3.qgl.iaad.ground;

import fr.unice.polytech.si3.qgl.iaad.Direction;
import fr.unice.polytech.si3.qgl.iaad.actions.Decision;
import fr.unice.polytech.si3.qgl.iaad.resource.Resource;
import fr.unice.polytech.si3.qgl.iaad.actions.Exploit;
import fr.unice.polytech.si3.qgl.iaad.actions.Ground;

import java.util.Map;

/**
 * @author Gaetan Vialon
 *         Created the 05/01/2017.
 */
public class ExploitResource implements ProtocolGround{

    /**
     * Le sous-protocole en cours d'utilisation
     */
    private ProtocolGround protocol;
    /**
     * Conservation du sens de parcours de la carte pour l'exploration de l'Ã®le
     */
    private Resource resource;

    private int nbofResource;

    private Map<Resource,Integer> contrat;


    public ExploitResource(Resource resource, int nbofResource, Map contrat)
    {
        this.resource = resource;
        this.nbofResource = nbofResource;
        this.contrat=contrat;
    }

    @Override
    public Decision nextAction()
    {
        return new Exploit(resource);
    }

    @Override
    public ProtocolGround setResult(Ground result)
    {
        nbofResource -= result.getAmountExploit();
        contrat.put(resource,contrat.get(resource)-result.getAmountExploit());
        if (contrat.get(resource)<=0) {
            contrat.remove(resource);
            if (contrat.isEmpty()) return new StopExplorer();
            else return new InitialisationGround(contrat,Direction.N);
        }
        if (result.getAmountExploit()==0 ) return new InitialisationGround(contrat, Direction.N);
        else return new ExploitResource(resource,nbofResource,contrat);
    }
}
